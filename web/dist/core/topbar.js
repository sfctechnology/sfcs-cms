const TopbarTemplate=require("../templates/topbar.hbs"),TopbarLayoutJumpList=require("../templates/toolbar-layout-jump-list.hbs");let Topbar=function(t,o,s=null,e={},a={},l=!1){this.parent=t,this.DOMObject=o,this.jumpList=a,this.customDropdownOptions=s,this.customActions=e,this.showOptions=l,this.firstRun=!0};Topbar.prototype.render=function(){this.firstRun&&(this.firstRun=!1);let t=this;const o=this.parent,s=o.getElementByTypeAndId(o.mainObjectType,o.mainObjectId);let e=$.extend(toolbarTrans,topbarTrans);const a=TopbarTemplate({customDropdownOptions:this.customDropdownOptions,displayTooltips:o.common.displayTooltips,trans:e,mainObject:s,showOptions:t.showOptions});this.DOMObject.html(a);const l=function(o){let s=!1;if(t.DOMObject.find("#"+o.id).click(o.action),null!=o.inactiveCheck){const e=null!=o.inactiveCheckClass?o.inactiveCheckClass:"disabled",a=o.inactiveCheck();t.DOMObject.find("#"+o.id).toggleClass(e,a),s=a}return s};if(null!=this.customDropdownOptions){let o=!1;for(let t=0;t<this.customDropdownOptions.length;t++)l(this.customDropdownOptions[t])||(o=!0);t.DOMObject.find(".dropdown.navbar-submenu:not(.navbar-submenu-options)").toggle(o)}$.isEmptyObject(this.jumpList)||0!=$("#layoutJumpList").length||this.setupJumpList($("#layoutJumpListContainer")),t.showOptions&&(t.DOMObject.find(".navbar-submenu-options-container").off().click((function(t){t.stopPropagation()})),t.DOMObject.find("#displayTooltips").off().click((function(){o.common.displayTooltips=$("#displayTooltips").prop("checked"),o.common.displayTooltips?toastr.success(editorsTrans.tooltipsEnabled):toastr.error(editorsTrans.tooltipsDisabled),o.toolbar.savePrefs(),o.common.reloadTooltips(o.editorContainer)})),"function"==typeof o.resetTour&&t.DOMObject.find("#resetTour").removeClass("hidden").off().click((function(){o.resetTour()}))),this.updateLayoutStatus()},Topbar.prototype.setupJumpList=function(t){const o=TopbarLayoutJumpList(this.jumpList);t.html(o),t.show();const s=t.find("#layoutJumpList");s.select2({ajax:{url:s.data().url,dataType:"json",data:function(t){var o={layout:t.term,start:0,length:10};if(null!=o.layout){var s=o.layout.match(/\[([^}]+)\]/);null!=s&&(o.tags=s[1],o.layout=o.layout.replace(s[0],""))}return null!=t.page&&(o.start=10*(t.page-1)),void 0!==t.term&&(localStorage.liveSearchPlaceholder=t.term),o},processResults:function(t,o){var s=[];$.each(t.data,(function(t,o){s.push({id:o.layoutId,text:o.layout})}));var e=o.page||1;return{results:s,pagination:{more:10*(e=e>1?e-1:e)<t.recordsTotal}}},delay:250}}),s.on("select2:select",(function(t){window.location=s.data().designerUrl.replace(":id",t.params.data.id)})).on("select2:opening",(function(t){if(null!=localStorage.liveSearchPlaceholder&&""!==localStorage.liveSearchPlaceholder){var o=s.data("select2").dropdown.$search;o.val(localStorage.liveSearchPlaceholder),setTimeout((function(){o.trigger("input")}),100)}}))},Topbar.prototype.updateLayoutStatus=function(){const t=this.DOMObject.find("#layout-info-status"),o=this.parent;if(t.find("i").removeClass().addClass("fa fa-spinner fa-spin"),t.removeClass().addClass("label label-default"),null==lD.layout.status)return;let s="",e="";const a={1:"success",2:"warning",3:"info","":"danger"},l={1:"check",2:"exclamation",3:"cogs","":"times"};if(lD.layout.status.messages.length>0){s=lD.layout.status.description;for(let t=0;t<lD.layout.status.messages.length;t++)e+='<div class="status-message">'+lD.layout.status.messages[t]+"</div>"}else s="",e='<div class="status-title text-center">'+lD.layout.status.description+"</div>";let i=null!=a[lD.layout.status.code]?a[lD.layout.status.code]:a[""];t.removeClass().addClass("label label-"+i).attr("data-status-code",lD.layout.status.code),null==t.data("bs.popover")?t.popover({delay:tooltipDelay,title:s,content:e}):(t.data("bs.popover").options.title=s,t.data("bs.popover").options.content=e),t.toggleClass("clickable",null==l[lD.layout.status.code]).on("click",(function(){null==l[lD.layout.status.code]&&o.timeline.scrollToBrokenWidget()}));let n=null!=l[lD.layout.status.code]?l[lD.layout.status.code]:l[""];t.find("i").removeClass().addClass("fa fa-"+n)},module.exports=Topbar;